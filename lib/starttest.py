#!/usr/bin/env python
# -*- coding: utf-8 -*-
import psutil
import subprocess, os, sys
from config import CTSCONSOLE

def terminate(pid):
    parent = psutil.Process(pid)
    if parent.is_running():
        for child in parent.get_children(True):
            if child.is_running():
                child.terminate()
        parent.terminate()

def startCTS():
    print "The test is starting now..."
    p = subprocess.Popen(("%s run cts --plan CTS" %('/'.join([os.getcwd(), CTSCONSOLE]))).split(), shell=False, stderr=subprocess.STDOUT, stdout=subprocess.PIPE)
    while True:
        line = p.stdout.readline()
        if line:
            sys.stdout.write(line)
            sys.stdout.flush()
        if "Time:" in line:
            time.sleep(5)
            self.__terminate(p.pid)
            print "Task Done!"
            break
    sys.exit()